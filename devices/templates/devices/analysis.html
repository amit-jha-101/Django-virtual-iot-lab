
{% extends 'devices/base.html' %} {% block content %}
<fieldset class="form-group">
  <legend class="border-bottom mb-4">
    Test Analysis
  </legend>
  <label for="sel_sensor">Select Sensor</label>
  <select class="form-control" id="sel_sensor">

    {% for sensor in sensors %}
    <option value="{{sensor.api}}">{{sensor.name}}</option>
    {% endfor %}
  </select>
  <br>
    <div class="form-row">
      <div class="col-md-3 mb-3">
        <label for="from">Start Date</label>
        <input type="date" class="form-control" id="from" required>
        <div class="invalid-feedback">
          Please provide a valid Value.
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <label for="to">End Date</label>
        <input type="date" class="form-control" id="to" required>
        <div class="invalid-feedback">
          Please provide a valid Value.
        </div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="displayData()">SHOW RESULTS</button>
</fieldset>
  
  <div style="height: 200px; overflow-y: scroll;" id="data">
  <p id="showData"></p>
  </div>


  <script>
  var myData = {};
  function displayData(){
    var uri="http://localhost:8000/api/makeTable/temp";
    
     $.ajax({
      url: uri,
      dataType: "json",
      async: false,
      success: function (data) {
        console.log(data)
        myData=data;
      }
  });
  
  CreateTableFromJSON(JSON.parse(myData["Items"]));
}
var columns = []
  
function CreateTableFromJSON(myData) {
        console.log("Started");
        
        var myBooks = myData;
        // EXTRACT VALUE FOR HTML HEADER. 
        // ('Book ID', 'Book Name', 'Category' and 'Price')
        var col = [];
        for (var i = 0; i < myBooks.length; i++) {
            for (var key in myBooks[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }
        columns = col;
        // CREATE DYNAMIC TABLE.
        var table = document.createElement("table");
        table.className = "table table-striped";

        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = table.insertRow(-1);                   // TABLE ROW.

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < myBooks.length; i++) {

            tr = table.insertRow(-1);

            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = myBooks[i][col[j]];
            }
        }

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("showData");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
        console.log("Ended");
        var btn = document.createElement("BUTTON");
        var t = document.createTextNode("Plot Graph");
        divContainer.appendChild(btn);
       btn.appendChild(t);
       btn.onclick = function(){
         getAxis();
       };
}
function getAxis(){
  var myDiv = document.getElementById("data");

    document.write("Select the y-axis feature");
    var selectList = document.createElement("select");
    selectList.id = "mySelecty";
    myDiv.appendChild(selectList);

   for (var i = 0; i < array.length; i++) {
     if (typeof myData[columns[i]] == "number"){
      var option = document.createElement("option");
      option.value = array[i];
      option.text = array[i];
      selectList.appendChild(option);
     
     }
    }
    document.write("Select the x-axis feature");
    var selectList = document.createElement("select");
    selectList.id = "mySelectx";
    myDiv.appendChild(selectList);

   for (var i = 0; i < array.length; i++) {
      var option = document.createElement("option");
      option.value = array[i];
      option.text = array[i];
      selectList.appendChild(option);
    } 

 }


  </script>
  {% endblock content %}